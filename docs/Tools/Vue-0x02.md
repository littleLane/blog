# Vue $dispatch å’Œ $broadcast

<a name="70761d53"></a>
## 00 å‰è¨€
$dispatch å’Œ $broadcast ä½œä¸ºä¸€å¯¹æƒ…ä¾£ ğŸ’‘å±æ€§ï¼Œåœ¨ Vue 1.0 ä¸­ä¸»è¦ç”¨æ¥å®ç°åŸºäºç»„ä»¶æ ‘ç»“æ„çš„äº‹ä»¶æµé€šä¿¡ â€”â€” é€šè¿‡å‘ä¸Šæˆ–å‘ä¸‹ä»¥å†’æ³¡çš„å½¢å¼ä¼ é€’äº‹ä»¶æµï¼Œä»¥å®ç°åµŒå¥—çˆ¶å­ç»„ä»¶çš„é€šä¿¡ã€‚ä½†æ˜¯ç”±äºå…¶æ˜¾åŠŸèƒ½ç¼ºé™·ï¼Œåœ¨ Vue 2.0 ä¸­å°±è¢«ç§»é™¤äº†ã€‚è™½ç„¶ Vue å®˜ç½‘å·²ç»ä¸å†æ”¯æŒä½¿ç”¨Â $dispatch å’Œ $broadcast è¿›è¡Œç»„ä»¶é€šä¿¡ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šåŸºäº Vue çš„ UI æ¡†æ¶ä¸­éƒ½æœ‰å¯¹å…¶çš„å°è£…ï¼ŒåŒ…æ‹¬ [**element-ui**](http://element-cn.eleme.io/#/zh-CN)ã€[iview](https://github.com/iview/iview)Â ç­‰ç­‰ã€‚

é‚£ä¹ˆÂ $dispatch å’Œ $broadcast åˆ°åº•æ˜¯æ€ä¹ˆå·¥ä½œï¼Œå…¶åº•å±‚åˆæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¯¦ç»†çš„è¯´ä¸€è¯´ï¼

<a name="175d38a3"></a>
## 01 $dispatch è¯¦è§£
ä¸ºäº†è¿½æ ¹æº¯æºï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆå» Vue 1.0 çš„æ–‡æ¡£ä½ è§‚æ‘©ä¸€ä¸‹å…¶æ¦‚å¿µå§ï¼

> **æ¦‚å¿µï¼š**

_**Dispatch an event, first triggering it on the instance itself, and then propagates upward along the parent chain. The propagation stops when it triggers a parent event listener, unless that listener returnsÂ ****`true`****. Any additional arguments will be passed into the listenerâ€™s callback function.**<br />_<br />ä¸Šé¢çš„ä¸€æ®µè‹±æ–‡å®šä¹‰æ¥è‡ª Vue 1.0 å®˜æ–¹æ–‡æ¡£ï¼Œå…¶å¤§è‡´çš„æ„æ€æ˜¯è¯´ï¼š**dispatch æ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œé¦–å…ˆä¼šåœ¨è‡ªå·±å®ä¾‹æœ¬èº«ä¸Šè§¦å‘ï¼Œç„¶åæ²¿çˆ¶é“¾å‘ä¸Šä¼ æ’­ã€‚å½“å®ƒè§¦å‘çˆ¶ç»„ä»¶ä¸Šçš„äº‹ä»¶ä¾¦å¬å™¨æ—¶ä¼ æ’­å³ä¼šåœæ­¢ï¼Œé™¤éè¯¥ä¾¦å¬å™¨è¿”å› trueã€‚ ä»»ä½•å…¶ä»–å‚æ•°éƒ½å°†ä¼ é€’ç»™ä¾¦å¬å™¨çš„å›è°ƒå‡½æ•°ã€‚**

> **å‚æ•°ï¼š**

dispatch ä¼šæ¥æ”¶ä¸¤ä¸­å‚æ•°ï¼ševent æ˜¯äº‹ä»¶åç§°ï¼Œ[...args] æ˜¯è§¦å‘äº‹ä»¶æ—¶ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚

> **ä¾‹å­ï¼š**

```javascript
// åˆ›å»ºä¸€ä¸ª parent ç»„ä»¶
var parent = new Vue();

// åˆ›å»ºä¸€ä¸ª child1 ç»„ä»¶ï¼Œå…¶çˆ¶ç»„ä»¶æŒ‡å‘ parent
var child1 = new Vue({ parent: parent });

// åˆ›å»ºä¸€ä¸ª child2 ç»„ä»¶ï¼Œå…¶çˆ¶ç»„ä»¶æŒ‡å‘ child1
var child2 = new Vue({ parent: child1 });

// åœ¨ parent ç»„ä»¶ç›‘å¬åä¸º test çš„äº‹ä»¶ï¼Œå¹¶ç»‘å®šäº†ä¸€ä¸ªå›è°ƒå‡½æ•°
parent.$on('test', function () {
  console.log('parent notified');
});

// åœ¨ child1 ç»„ä»¶ç›‘å¬åä¸º test çš„äº‹ä»¶ï¼Œå¹¶ç»‘å®šäº†ä¸€ä¸ªå›è°ƒå‡½æ•°
child1.$on('test', function () {
  console.log('child1 notified');
});

// åœ¨ child2 ç»„ä»¶ç›‘å¬åä¸º test çš„äº‹ä»¶ï¼Œå¹¶ç»‘å®šäº†ä¸€ä¸ªå›è°ƒå‡½æ•°
child2.$on('test', function () {
  console.log('child2 notified');
});
```

è¯´åˆ°è¿™é‡Œï¼Œparentã€child1Â å’ŒÂ child2 ä¸‰ä¸ªç»„ä»¶ä¹‹é—´çš„å…³ç³»å¯ä»¥å±•ç¤ºæˆå¦‚ä¸‹çš„å…³ç³»å›¾ï¼š<br />
![é«˜é˜¶ç»„ä»¶ (4).png](https://cdn.nlark.com/yuque/0/2019/png/114852/1551870035081-a5c673d4-9ed2-4e31-96b2-343c54c0b449.png#align=left&display=inline&height=362&name=%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%20%284%29.png&originHeight=370&originWidth=194&size=4444&status=done&width=190)<br />

```javascript
// åœ¨ child2 ç»„ä»¶ä¸­é€šè¿‡ dispatch è§¦å‘ test äº‹ä»¶
child2.$dispatch('test');

// äº‹ä»¶æ‰§è¡Œä¼šè¾“å‡ºå¦‚ä¸‹ç»“æœ
// -> "child2 notified"
// -> "child1 notified"
```

å½“æ‰§è¡ŒÂ child2.$dispatch('test'); æ—¶ï¼Œé¦–å…ˆä¼šè§¦å‘ child2 ç»„ä»¶é‡Œé¢ç›‘å¬çš„ test äº‹ä»¶çš„å›è°ƒå‡½æ•°ï¼Œè¾“å‡ºÂ 'child2 notified'ï¼Œæ ¹æ®ä¸Šé¢å®˜æ–¹æ–‡æ¡£çš„å®šä¹‰ï¼Œäº‹ä»¶ä¼šæ²¿ç€ç»„ä»¶å…³ç³»é“¾ä¸€ç›´å‘ä¸Šä¼ é€’ï¼Œç„¶åä¼ é€’åˆ° child1 ç»„ä»¶ï¼Œè§¦å‘ç›‘å¬äº‹ä»¶è¾“å‡ºÂ "child1 notified"ï¼Œä½†æ˜¯è¯¥ä¾¦å¬å™¨æ²¡æœ‰è¿”å› trueï¼Œæ‰€ä»¥äº‹ä»¶ä¼ é€’åˆ°æ­¤å°±ç»“æŸäº†ï¼Œæœ€ç»ˆçš„è¾“å‡ºç»“æœå°±åªæœ‰Â "child2 notified" å’ŒÂ "child1 notified"ã€‚

> **Vue 1.0 å®˜æ–¹å®ç°**


åœ¨ Vue 1.0 ç‰ˆæœ¬ä¸­ï¼Œ$dispatch å®ç°çš„æºç æ”¾åœ¨Â /src/instance/api/events.js æ–‡ä»¶ä¸­ï¼Œä»£ç å¾ˆç®€å•ï¼š

```javascript
/**
 * Recursively propagate an event up the parent chain.
 * é€’å½’åœ°åœ¨çˆ¶é“¾ä¸Šä¼ æ’­äº‹ä»¶ã€‚
 * @param {String} event
 * @param {...*} additional arguments
 */
// $dispatch æ–¹æ³•æ˜¯å®šä¹‰åœ¨ Vue çš„ prototype ä¸Šçš„
// æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„äº‹ä»¶åç§°
Vue.prototype.$dispatch = function (event) {
  // é¦–å…ˆæ‰§è¡Œ $emit è§¦å‘äº‹ä»¶ï¼Œå°†è¿”å›å€¼ä¿å­˜åœ¨ shouldPropagate ä¸­
  var shouldPropagate = this.$emit.apply(this, arguments)
  
  // å¦‚æœé¦–æ¬¡æ‰§è¡Œçš„ $emit æ–¹æ³•è¿”å›çš„å€¼ä¸æ˜¯ true å°±ç›´æ¥è¿”å›
  // å¦‚æœè¿”å›å€¼ä¸æ˜¯ true å°±è¯´æ˜ç»„ä»¶é€»è¾‘ä¸å¸Œæœ›äº‹ä»¶ç»§ç»­å¾€çˆ¶ç»„ä»¶è¿›è¡Œä¼ é€’
  if (!shouldPropagate) return
  
  // å¦‚æœé¦–æ¬¡æ‰§è¡Œ $emit æ–¹æ³•è¿”å›å€¼æ˜¯ true å°±è·å–å½“å‰ç»„ä»¶çš„ parent ç»„ä»¶å®ä¾‹
  var parent = this.$parent
  
  // å°†å‡½æ•°æ¥å—çš„å‚æ•°è½¬æ¢æˆæ•°ç»„
  var args = toArray(arguments)
  
  // use object event to indicate non-source emit on parents
  // æ ¹æ®ä¼ å…¥çš„äº‹ä»¶åç§°çš„å‚æ•°ç»„è£…æˆ object
  args[0] = { name: event, source: this }
  
  // å¾ªç¯çŸ¥é“ç»„ä»¶çš„çˆ¶ç»„ä»¶
  while (parent) {
    // åœ¨çˆ¶ç»„ä»¶ä¸­æ‰§è¡Œ $emit è§¦å‘äº‹ä»¶
    shouldPropagate = parent.$emit.apply(parent, args)
    
    // å¦‚æœçˆ¶ç»„ä»¶ $emit è¿”å›çš„æ˜¯ true å°±ç»§ç»­é€’å½’ç¥–çˆ¶ç»„ä»¶ï¼Œå¦åˆ™å°±åœæ­¢å¾ªç¯
    parent = shouldPropagate ? parent.$parent : null
  }
  
  // æœ€åè¿”å›å½“å‰ç»„ä»¶å®ä¾‹
  return this
}
```

> **element-ui å®ç°**


åœ¨ Element-UI ä¸­ï¼Œ$dispatch å®ç°çš„æºç æ”¾åœ¨Â /src/mixins/emitter.js æ–‡ä»¶ä¸­ï¼Œä»£ç å¾ˆç®€å•ï¼š

```javascript
// å®šä¹‰ dispatch æ–¹æ³•ï¼Œæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šç»„ä»¶åç§°ã€å°†è¦è§¦å‘çš„äº‹ä»¶åç§°ã€å›è°ƒå‡½æ•°ä¼ é€’çš„å‚æ•°
dispatch(componentName, eventName, params) {
  // è·å–åŸºäºå½“å‰ç»„ä»¶çš„çˆ¶ç»„ä»¶å®ä¾‹ï¼Œè¿™é‡Œå¯¹çˆ¶ç»„ä»¶å®ä¾‹å’Œæ ¹ç»„ä»¶å®ä¾‹åšäº†å…¼å®¹å¤„ç†
  var parent = this.$parent || this.$root;
  
  // é€šè¿‡çˆ¶ç»„ä»¶çš„ $option å±æ€§è·å–ç»„ä»¶çš„åç§°
  var name = parent.$options.componentName;

  // å½“ç›¸å¯¹å½“å‰ç»„ä»¶çš„çˆ¶ç»„ä»¶å®ä¾‹å­˜åœ¨ï¼Œè€Œä¸”å½“çˆ¶ç»„ä»¶çš„åç§°ä¸å­˜åœ¨æˆ–è€…çˆ¶ç»„ä»¶çš„åç§°ä¸ç­‰äºä¼ å…¥çš„ç»„ä»¶åç§°æ—¶ï¼Œæ‰§è¡Œå¾ªç¯
  while (parent && (!name || name !== componentName)) {
    // è®°å½•çˆ¶ç»„ä»¶çš„çˆ¶ç»„ä»¶
    parent = parent.$parent;

    // å½“çˆ¶ç»„ä»¶çš„çˆ¶ç»„ä»¶å­˜åœ¨æ—¶ï¼Œè·å–ç¥–çˆ¶ç»„ä»¶çš„åç§°
    if (parent) {
      name = parent.$options.componentName;
    }
  }
  
  // å½“å¾ªç¯ç»“æŸæ˜¯ï¼Œparent çš„å€¼å°±æ˜¯æœ€ç»ˆåŒ¹é…çš„ç»„ä»¶å®ä¾‹
  if (parent) {
    // å½“ parent å€¼å­˜åœ¨æ—¶è°ƒç”¨ $emit æ–¹æ³•
    // ä¼ å…¥ parent å®ä¾‹ã€äº‹ä»¶åç§°ä¸ params å‚æ•°ç»„æˆçš„æ•°ç»„
    // è§¦å‘ä¼ å…¥äº‹ä»¶åç§° eventName åŒåçš„äº‹ä»¶
    parent.$emit.apply(parent, [eventName].concat(params));
  }
}
```

> **å·®å¼‚åˆ†æ**


ä»”ç»†çœ‹å®Œå®ç° $dispatch æ–¹å¼çš„ä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç ï¼Œå¤§å®¶æ˜¯ä¸æ˜¯å‘ç°ï¼Œä¸¤ä¸ªç‰ˆæœ¬çš„å®ç°å’ŒåŠŸèƒ½å·®å¼‚æ€§è¿˜æ˜¯å¾ˆå¤§çš„ã€‚

- 1ã€æ¥å—å‚æ•°ï¼šVue å®ç°ç‰ˆæœ¬åªä¼šæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„äº‹ä»¶åç§°ä¸ºå‚æ•°ï¼Œè€Œ element-ui å®ç°çš„ç‰ˆæœ¬ä¼šæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šéœ€è¦è§¦å‘äº‹ä»¶çš„ç»„ä»¶åç§°ã€å°†è¦è§¦å‘çš„äº‹ä»¶åç§°ã€å›è°ƒå‡½æ•°ä¼ é€’çš„å‚æ•°ï¼›

- 2ã€å®ç°åŠŸèƒ½ï¼šVue å®ç°ç‰ˆæœ¬è§¦å‘äº‹ä»¶ä¸€ç›´ä¼šé¡ºç€ç»„ä»¶é“¾å‘ä¸Šè¿›è¡Œä¼ é€’ï¼ŒçŸ¥é“çˆ¶ç»„ä»¶ä¸­çš„ä¾¦å¬å™¨æ²¡æœ‰è¿”å› trueï¼Œåœ¨è¿™ä¸ªæœŸé—´æ‰€æœ‰çš„ç»„ä»¶éƒ½ä¼šæ‰§è¡Œäº‹ä»¶çš„å“åº”ï¼ŒåŒ…æ‹¬å½“å‰ç»„ä»¶æœ¬èº«ï¼Œè€Œ element-ui å®ç°ç‰ˆæœ¬ä¼šä¸æ–­çš„åŸºäºå½“å‰ç»„ä»¶å‘çˆ¶ç»„ä»¶è¿›è¡Œéå†ï¼Œç›´è‡³æ‰¾åˆ°å’Œæ¥å—çš„ç»„ä»¶åç§°åŒ¹é…ï¼Œå°±ä¼šåœæ­¢éå†ï¼Œè§¦å‘åŒ¹é…ç»„ä»¶ä¸­çš„ç›‘å¬äº‹ä»¶ã€‚

<a name="3d7550fe"></a>
## 10 $broadcast è¯¦è§£
ä¸Šé¢è¯¦ç»†çš„è¯´å®Œ $dispatch æ–¹æ³•çš„å®ç°å’Œ Vue å®ç°ç‰ˆæœ¬ä¸ element-ui å®ç°ç‰ˆæœ¬çš„åŒºåˆ«ï¼Œä¸‹é¢å°±è¯¥è¯´è¯´ $broadcastï¼Œæ¯•ç«Ÿä»–ä»¬æ˜¯æƒ…ä¾£å±æ€§å˜›ã€‚

> **æ¦‚å¿µ**

_Broadcast an event that propagates downward to all descendants of the current instance. Since the descendants expand into multiple sub-trees, the event propagation will follow many different â€œpathsâ€. The propagation for each path will stop when a listener callback is fired along that path, unless the callback returnsÂ _`_true_`_**.**_<br /><br />Broadcast æ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œå®ƒå‘ä¸‹ä¼ æ’­åˆ°å½“å‰å®ä¾‹çš„æ‰€æœ‰åä»£ã€‚ç”±äºåä»£æ‰©å±•ä¸ºå¤šä¸ªå­æ ‘ï¼Œäº‹ä»¶ä¼ æ’­å°†ä¼šéµå¾ªè®¸å¤šä¸åŒçš„â€œè·¯å¾„â€ã€‚ é™¤éå›è°ƒè¿”å› trueï¼Œå¦åˆ™åœ¨æ²¿è¯¥è·¯å¾„è§¦å‘ä¾¦å¬å™¨å›è°ƒæ—¶ï¼Œæ¯ä¸ªè·¯å¾„çš„ä¼ æ’­å°†ä¼šåœæ­¢ã€‚

> **å‚æ•°**

<br />broadcast ä¼šæ¥æ”¶ä¸¤ä¸­å‚æ•°ï¼ševent æ˜¯äº‹ä»¶åç§°ï¼Œ[...args] æ˜¯è§¦å‘äº‹ä»¶æ—¶ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚

> **ä¾‹å­**


```javascript
// åˆ›å»º parent ç»„ä»¶å®ä¾‹
var parent = new Vue()

// åˆ›å»º child1 ç»„ä»¶å®ä¾‹ï¼Œå…¶çˆ¶ç»„ä»¶æŒ‡å‘ parent
var child1 = new Vue({ parent: parent })

// åˆ›å»º child2 ç»„ä»¶å®ä¾‹ï¼Œå…¶çˆ¶ç»„ä»¶æŒ‡å‘ parent
var child2 = new Vue({ parent: parent })

// åˆ›å»º child3 ç»„ä»¶å®ä¾‹ï¼Œå…¶çˆ¶ç»„ä»¶æŒ‡å‘ child2
var child3 = new Vue({ parent: child2 })

// åœ¨ child1 ç»„ä»¶ç›‘å¬åä¸º test çš„äº‹ä»¶ï¼Œå¹¶ç»‘å®šäº†ä¸€ä¸ªå›è°ƒå‡½æ•°
child1.$on('test', function () {
  console.log('child1 notified')
})

// åœ¨ child2 ç»„ä»¶ç›‘å¬åä¸º test çš„äº‹ä»¶ï¼Œå¹¶ç»‘å®šäº†ä¸€ä¸ªå›è°ƒå‡½æ•°
child2.$on('test', function () {
  console.log('child2 notified')
})

// åœ¨ child3 ç»„ä»¶ç›‘å¬åä¸º test çš„äº‹ä»¶ï¼Œå¹¶ç»‘å®šäº†ä¸€ä¸ªå›è°ƒå‡½æ•°
child3.$on('test', function () {
  console.log('child3 notified')
})
```

parentã€child1ã€child2 å’Œ child3 å››ä¸ªç»„ä»¶ä¹‹é—´çš„å…³ç³»å¯ä»¥å±•ç¤ºæˆå¦‚ä¸‹çš„å…³ç³»å›¾ï¼š<br />![é«˜é˜¶ç»„ä»¶ (5).png](https://cdn.nlark.com/yuque/0/2019/png/114852/1551875942057-18c8899a-6c5c-4015-a4f7-38f2e755dcc1.png#align=left&display=inline&height=363&name=%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%20%285%29.png&originHeight=399&originWidth=345&size=8819&status=done&width=314)
```javascript
parent.$broadcast('test')
// -> "child1 notified"
// -> "child2 notified"
```

å½“æ‰§è¡ŒÂ parent.$broadcast('test'); æ—¶ï¼Œäº‹ä»¶æµä¼šä»¥ parent ç»„ä»¶ä¸ºèµ·ç‚¹å‘ parent çš„å­ç»„ä»¶è¿›è¡Œä¼ é€’ï¼Œæ ¹æ®äº‹ä»¶ç»‘å®šçš„é¡ºåºï¼Œè™½ç„¶ parent ç»„ä»¶æœ‰ä¸¤ä¸ªåŒçº§çš„ child1 å’Œ child2 ï¼Œä½†æ˜¯äº‹ä»¶æµä¼šå…ˆè§¦å‘ child1 é‡Œé¢çš„ç»‘å®šäº‹ä»¶ï¼Œæ­¤æ—¶ä¼šè¾“å‡º "child1 notified"ï¼Œç„¶åäº‹ä»¶æµåˆ°è¾¾ child2 ç»„ä»¶ï¼Œä¼šè§¦å‘ child2 ç»„ä»¶ä¸­çš„ç»‘å®šäº‹ä»¶ï¼Œè¾“å‡º "child2 notified"ã€‚åˆ°è¿™æ—¶ï¼Œchild2 ç»„ä»¶ä¸­çš„ä¾¦å¬å™¨å¹¶æ²¡æœ‰è¿”å› trueï¼Œæ‰€ä»¥äº‹ä»¶ä¼ é€’åˆ°æ­¤å°±ç»“æŸäº†ï¼Œæœ€ç»ˆçš„è¾“å‡ºç»“æœå°±åªæœ‰Â "child1 notified" å’ŒÂ "child2 notified"ã€‚

> **Vue 1.0 å®˜æ–¹å®ç°**

<br />åœ¨ Vue 1.0 ç‰ˆæœ¬ä¸­ï¼Œ$broadcast å®ç°çš„æºç æ”¾åœ¨Â /src/instance/api/events.js æ–‡ä»¶ä¸­ï¼Œä»£ç å¾ˆç®€å•ï¼š

```javascript
/**
 * Recursively broadcast an event to all children instances.
 * é€’å½’åœ°å‘æ‰€æœ‰å­å®ä¾‹å¹¿æ’­äº‹ä»¶ã€‚
 * @param {String|Object} event
 * @param {...*} additional arguments
 */
// $dispatch æ–¹æ³•æ˜¯å®šä¹‰åœ¨ Vue çš„ prototype ä¸Šçš„
// æ¥å—ä¸€ä¸ªäº‹ä»¶
Vue.prototype.$broadcast = function (event) {
  // è·å–ä¼ å…¥äº‹ä»¶çš„ç±»å‹ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºå­—ç¬¦ä¸²
  var isSource = typeof event === 'string'
  
  // æ ¡æ­£ event çš„å€¼ï¼Œå½“æ¥å— event çš„ç±»å‹ä¸ºå­—ç¬¦ä¸²æ—¶å°±ç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœä¸æ˜¯å­—ç¬¦ä¸²å°±ä½¿ç”¨ event ä¸Šçš„ name å±æ€§ 
  event = isSource ? event : event.name
  
  // if no child has registered for this event,
  // then there's no need to broadcast.
  // å¦‚æœå½“å‰ç»„ä»¶çš„å­ç»„ä»¶æ²¡æœ‰æ³¨å†Œè¯¥äº‹ä»¶ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¹¶ä¸ç”¨ broadcast
  if (!this._eventsCount[event]) return
  
  // è·å–å½“å‰ç»„ä»¶çš„å­ç»„ä»¶
  var children = this.$children
  
  // å°†å‡½æ•°æ¥å—çš„å‚æ•°è½¬æ¢æˆæ•°ç»„
  var args = toArray(arguments)
  
  // å¦‚æœä¼ å…¥äº‹ä»¶ä¸ºå­—ç¬¦ä¸²
  if (isSource) {
    // use object event to indicate non-source emit
    // on children
    // æ ¹æ®ä¼ å…¥çš„äº‹ä»¶åç§°çš„å‚æ•°ç»„è£…æˆ object
    args[0] = { name: event, source: this }
  }
  
  // å¾ªç¯å­ç»„ä»¶
  for (var i = 0, l = children.length; i < l; i++) {
    var child = children[i]
    
    // åœ¨æ¯ä¸ªå­ç»„ä»¶ä¸­è°ƒç”¨ $emit è§¦å‘äº‹ä»¶
    var shouldPropagate = child.$emit.apply(child, args)
    
    // åˆ¤æ–­è°ƒç”¨ $emit è¿”å›çš„å€¼æ˜¯å¦ä¸º true
    if (shouldPropagate) {
      // å¦‚æœè°ƒç”¨ $emit è¿”å›çš„å€¼ä¸º trueï¼Œå°±é€’å½’å­™å­ç»„ä»¶ç»§ç»­å¹¿æ’­
      child.$broadcast.apply(child, args)
    }
  }
  
  // æœ€åè¿”å›å½“å‰ç»„ä»¶çš„å®ä¾‹
  return this
}
```

> **element-ui å®ç°**

<br />åœ¨ Element-UI ä¸­ï¼Œ$broadcast å®ç°çš„æºç æ”¾åœ¨Â /src/mixins/emitter.js æ–‡ä»¶ä¸­ï¼Œä»£ç å¾ˆç®€å•ï¼š

```javascript
// å®šä¹‰ broadcast æ–¹æ³•ï¼Œæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šç»„ä»¶åç§°ã€å°†è¦è§¦å‘çš„äº‹ä»¶åç§°ã€å›è°ƒå‡½æ•°ä¼ é€’çš„å‚æ•°
function broadcast(componentName, eventName, params) {
  // ä¾æ¬¡å¾ªç¯å½“å‰ç»„ä»¶çš„å­ç»„ä»¶
  this.$children.forEach(child => {
    // è·å–æ¯ä¸ªå­ç»„ä»¶çš„åå­—
    var name = child.$options.componentName;

    // åˆ¤æ–­å­ç»„ä»¶çš„åå­—æ˜¯å¦ç­‰äºä¼ å…¥çš„ç»„ä»¶åç§°
    if (name === componentName) {
      // å¦‚æœå­ç»„ä»¶çš„åå­—ç­‰äºä¼ å…¥çš„ç»„ä»¶åç§°å°±è°ƒç”¨ $emit è§¦å‘äº‹ä»¶
      child.$emit.apply(child, [eventName].concat(params));
    } else {
      // å¦‚æœå­ç»„ä»¶çš„åå­—ä¸ç­‰äºä¼ å…¥çš„ç»„ä»¶åç§°å°±é€’å½’éå†è°ƒç”¨ broadcast å­™å­ç»„ä»¶
      broadcast.apply(child, [componentName, eventName].concat([params]));
    }
  });
}
```

> **å·®å¼‚åˆ†æ**

<br />å’Œä¹‹å‰è¯´åˆ°çš„ $dispatch ä¸€æ ·ï¼Œè¿™é‡Œçš„ $broadcast çš„ä¸¤ä¸ªå®ç°ç‰ˆæœ¬ä¹Ÿå­˜åœ¨ç€å·¨å¤§çš„å·®å¼‚ï¼š

- 1ã€æ¥å—å‚æ•°ï¼šVue å®ç°ç‰ˆæœ¬åªä¼šæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„äº‹ä»¶åç§°ä¸ºå‚æ•°ï¼Œè€Œ element-ui å®ç°çš„ç‰ˆæœ¬ä¼šæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šéœ€è¦è§¦å‘äº‹ä»¶çš„ç»„ä»¶åç§°ã€å°†è¦è§¦å‘çš„äº‹ä»¶åç§°ã€å›è°ƒå‡½æ•°ä¼ é€’çš„å‚æ•°ï¼›

- 2ã€å®ç°åŠŸèƒ½ï¼šVue å®ç°çš„Â $broadcastÂ è§¦å‘æ–¹å¼æ˜¯**é»˜è®¤**åªè§¦å‘å­ä»£ç»„ä»¶ï¼Œä¸è§¦å‘å­™å­ä»£ç»„ä»¶ï¼Œå¦‚æœå­ä»£åˆ›å»ºäº†ç›‘å¬ä¸”è¿”å›äº†trueï¼Œæ‰ä¼šå‘å­™å­ä»£ç»„ä»¶ä¼ é€’äº‹ä»¶ã€‚è€Œ element-ui å®ç°çš„ç‰ˆæœ¬æ˜¯ç›´æ¥å‘æ‰€æœ‰å­å­™åä»£ç»„ä»¶ä¼ é€’ï¼Œç›´è‡³è·å–åˆ°çš„å­ç»„ä»¶åç§°ç­‰äºä¼ å…¥çš„ç»„ä»¶åç§°ç›¸ç­‰ï¼Œæ‰ä¼šè§¦å‘å½“å‰å­ç»„ä»¶çš„ç›‘å¬äº‹ä»¶ï¼ŒæœŸé—´ä¹Ÿæ²¡æœ‰è¿”å›å€¼çš„åˆ¤å®šã€‚

<a name="bbe8fac5"></a>
## 11 æ€»ç»“
è¯´åˆ°è¿™é‡Œï¼Œ$dispatch å’ŒÂ $broadcast çš„è®²è§£å°±ç»“æŸäº†ã€‚å¯èƒ½å¤§å®¶å·²ç»çŸ¥é“äº† Vue 2.0 ç‰ˆæœ¬ä¸ºä»€ä¹ˆä¼šå°†è¿™ä¸¤ä¸ªå±æ€§ç§»é™¤ã€‚é¦–å…ˆæˆ‘ä»¬å¼•å…¥[å®˜ç½‘](https://cn.vuejs.org/v2/guide/migration.html#dispatch-%E5%92%8C-broadcast-%E6%9B%BF%E6%8D%A2)çš„è¯´æ³•ï¼š

_å› ä¸ºåŸºäºç»„ä»¶æ ‘ç»“æ„çš„äº‹ä»¶æµæ–¹å¼å®åœ¨æ˜¯è®©äººéš¾ä»¥ç†è§£ï¼Œå¹¶ä¸”åœ¨ç»„ä»¶ç»“æ„æ‰©å±•çš„è¿‡ç¨‹ä¸­ä¼šå˜å¾—è¶Šæ¥è¶Šè„†å¼±ã€‚è¿™ç§äº‹ä»¶æ–¹å¼ç¡®å®ä¸å¤ªå¥½ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›åœ¨ä»¥åè®©å¼€å‘è€…ä»¬å¤ªç—›è‹¦ã€‚å¹¶ä¸” __`$dispatch`__Â å’ŒÂ __`$broadcast`__Â ä¹Ÿæ²¡æœ‰è§£å†³å…„å¼Ÿç»„ä»¶é—´çš„é€šä¿¡é—®é¢˜ã€‚_<br /><br />è¿™æ ·æ¥è¯´Â $dispatch å’ŒÂ $broadcast ç¡®å®ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ã€‚åœ¨å‰é¢çš„è®²è§£ä¸­ï¼Œå¤§å®¶ä¹Ÿä¸éš¾å‘ç°Â $dispatch ä¸»è¦æ˜¯äº‹ä»¶æµç”±å½“å‰ç»„ä»¶å¾€çˆ¶ç»„ä»¶æµåŠ¨ï¼Œå½“æ»¡è¶³ä¸€å®šæ¡ä»¶çš„æ—¶å€™å°±ä¼šè§¦å‘å½“å‰å­ç»„ä»¶çš„ç›‘å¬äº‹ä»¶ï¼Œ$broadcast çš„åŠŸèƒ½æ˜¯äº‹ä»¶æµç”±å½“å‰ç»„ä»¶å‘å­ç»„ä»¶æµåŠ¨ï¼Œå½“æ»¡è¶³ä¸€å®šæ¡ä»¶çš„æ—¶å€™å°±ä¼šè§¦å‘å½“å‰å­ç»„ä»¶çš„ç›‘å¬äº‹ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´Â $dispatch å’ŒÂ $broadcast ä¸»è¦è§£å†³äº†çˆ¶å­ç»„ä»¶ã€åµŒå¥—çˆ¶å­ç»„ä»¶çš„é€šä¿¡ï¼Œå¹¶æ²¡æœ‰è§£å†³å…„å¼Ÿç»„ä»¶çš„é€šä¿¡é—®é¢˜ï¼Œå¦ä¸€ä¸ªæ–¹é¢è¿™æ ·çš„äº‹ä»¶æµåŠ¨çš„æ–¹å¼æ˜¯åŸºäºç»„ä»¶æ ‘ç»“æ„çš„ï¼Œå½“ä¸šåŠ¡è¶Šæ¥è¶Šçƒ¦æ‚æ—¶ï¼Œè¿™ç§æ–¹å¼ä¼šæ˜¾å¾—æå…¶ç¹çï¼Œç”šè‡³ä¼šæ··ä¹±åˆ°éš¾ä»¥ç»´æŠ¤ï¼Œæ‰€ä»¥ Vue 2.0 ç‰ˆæœ¬ç§»é™¤è¿™ä¸¤ä¸ª API æ˜¯åœ¨æ„æ–™ä¹‹ä¸­çš„ã€‚

ä½†æ˜¯ä¸ºä»€ä¹ˆä¸‰æ–¹ UI åº“éƒ½ä¼šå°è£…ç±»ä¼¼çš„è¿™æ ·ä¸€ä¸ªç»„ä»¶é€šä¿¡çš„æ–¹å¼å‘¢ï¼Ÿæˆ‘çš„çŒœæµ‹å¯èƒ½æ˜¯ä¸ºäº†è§£å†³åœ¨çˆ¶å­å±‚åµŒå¥—ç»„ä»¶ä¸­ï¼Œé€šè¿‡Â $dispatch å’ŒÂ $broadcast å®šå‘çš„å‘æŸä¸ªçˆ¶æˆ–è€…å­ç»„ä»¶**è¿œç¨‹è°ƒç”¨**äº‹ä»¶ï¼Œè¿™æ ·å°±é¿å…äº†é€šè¿‡ä¼  props æˆ–è€…ä½¿ç”¨ refs è°ƒç”¨ç»„ä»¶å®ä¾‹æ–¹æ³•çš„æ“ä½œã€‚è¿™æ ·è¯´çš„è¯ï¼Œ$dispatch å’ŒÂ $broadcast ä¹Ÿå°±å…¶å­˜åœ¨çš„ä»·å€¼ï¼Œè€Œå¹¶ä¸æ˜¯ä¸€æ— æ˜¯å¤„çš„ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼š**æŠ€æœ¯æ²¡æœ‰å¥½ä¸åï¼Œåªæœ‰åˆé€‚ä¸åˆé€‚**ï¼
